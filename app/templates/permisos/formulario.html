<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nuevo Permiso - SistPRO</title>

    <!-- CSS Principal -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">

    <!-- CSS especÃ­fico para permisos -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/permisos.css') }}">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="container">
            <nav class="header-nav">
                <a href="{{ url_for('permiso.listado') }}" class="btn-back">
                    <span class="icon">â†</span> Volver a Permisos
                </a>

                <div class="header-actions">
                    {% if current_user.rol == 'admin' %}
                    <a href="{{ url_for('docente.nuevo') }}" class="btn btn-outline">
                        <span class="icon">ğŸ‘¨â€ğŸ«</span> Nuevo Docente
                    </a>
                    {% endif %}

                    <a href="{{ url_for('auth.logout') }}" class="btn btn-danger">
                        <span class="icon">ğŸšª</span> Salir
                    </a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Contenido principal -->
    <main class="main-content">
        <div class="container">
            <div class="page-header">
                <h1 class="page-title">
                    <span class="icon">â•</span> Nuevo Permiso
                </h1>
                <p class="page-subtitle">Registra un nuevo permiso para un docente</p>
            </div>

            <!-- Mensajes Flash -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="flash-messages">
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <!-- Formulario -->
            <div class="card">
                <!-- CORREGIDO: endpoint correcto -->
                <form method="POST" action="{{ url_for('permiso.formulario') }}" id="permiso-form" class="permiso-form">
                    <!-- SecciÃ³n: Docente -->
                    <section class="form-section">
                        <h2 class="form-section-title">
                            <span class="icon">ğŸ‘¨â€ğŸ«</span> Docente
                        </h2>

                        <div class="form-group">
                            <label for="docente_id" class="form-label required">
                                Seleccionar docente
                            </label>

                            <!-- CORREGIDO: sintaxis Jinja2 vÃ¡lida -->
                            {% set docente_seleccionado = request.args.get('docente_id', 0)|int %}

                            <select name="docente_id" id="docente_id" class="form-select" required>
                                <option value="">-- Seleccione un docente --</option>
                                {% for docente in docentes %}
                                <option value="{{ docente.id }}"
                                        {% if docente_seleccionado == docente.id %}selected{% endif %}>
                                    {{ docente.nombre }} {{ docente.apellido }}
                                </option>
                                {% endfor %}
                            </select>
                            <small class="form-text">
                                Â¿No encuentras al docente?
                                <a href="{{ url_for('docente.nuevo') }}" class="text-link">
                                    Crear nuevo docente
                                </a>
                            </small>
                        </div>

                        <!-- Historial de permisos (se carga dinÃ¡micamente) -->
                        <div id="historial-permisos" class="historial-section"></div>
                    </section>

                    <!-- SecciÃ³n: Detalles del permiso -->
                    <section class="form-section">
                        <h2 class="form-section-title">
                            <span class="icon">ğŸ“‹</span> Detalles del permiso
                        </h2>

                        <div class="form-group">
                            <label for="tipo" class="form-label required">Tipo de permiso</label>
                            <select name="tipo" id="tipo" class="form-select" required>
                                <option value="">-- Seleccione el tipo --</option>
                                <option value="Vacaciones">ğŸ–ï¸ Vacaciones</option>
                                <option value="Enfermedad">ğŸ¤’ Enfermedad</option>
                                <option value="CapacitaciÃ³n">ğŸ“š CapacitaciÃ³n</option>
                                <option value="Permiso Personal">ğŸ‘¤ Permiso Personal</option>
                                <option value="Licencia">ğŸ“„ Licencia</option>
                                <option value="Otro">â“ Otro</option>
                            </select>
                        </div>

                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="fecha_inicio" class="form-label required">Fecha de inicio</label>
                                    <input type="date" name="fecha_inicio" id="fecha_inicio"
                                           class="form-control" required>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label for="fecha_fin" class="form-label required">Fecha de fin</label>
                                    <input type="date" name="fecha_fin" id="fecha_fin"
                                           class="form-control" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="observacion" class="form-label">Observaciones</label>
                            <textarea name="observacion" id="observacion"
                                      class="form-control" rows="4"
                                      placeholder="Describe el motivo del permiso, detalles importantes, etc."></textarea>
                            <small class="form-text">
                                Esta informaciÃ³n serÃ¡ visible para los administradores.
                            </small>
                        </div>
                    </section>

                    <!-- SecciÃ³n: Acciones -->
                    <section class="form-actions">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <span class="icon">ğŸ’¾</span> Guardar permiso
                        </button>
                        <a href="{{ url_for('permiso.listado') }}" class="btn btn-secondary">
                            <span class="icon">â†©ï¸</span> Cancelar
                        </a>
                    </section>
                </form>
            </div>

            <!-- InformaciÃ³n importante -->
            <aside class="info-card">
                <h3 class="info-card-title">
                    <span class="icon">ğŸ“</span> Notas importantes
                </h3>
                <ul class="info-list">
                    <li>Los campos marcados con <span class="required">*</span> son obligatorios.</li>
                    <li>El permiso se registrarÃ¡ automÃ¡ticamente para tu colegio.</li>
                    <li>Puedes crear nuevos docentes desde el botÃ³n "Nuevo Docente".</li>
                    <li>Verifica que las fechas sean correctas antes de guardar.</li>
                    <li>Los permisos aprobados no pueden ser modificados posteriormente.</li>
                </ul>
            </aside>
        </div>
    </main>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <p class="footer-text">
                SistPRO Â© 2024 - Sistema de GestiÃ³n de Permisos Escolares
            </p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/formulario-permiso.js') }}"></script>
</body>
</html>