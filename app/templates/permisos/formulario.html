<!-- templates/permisos/formulario.html -->
{% extends "base.html" %}

{% block title %}Nuevo Permiso{% endblock %}

{% block content %}

<h4 class="mb-4">‚ûï Registrar Nuevo Permiso</h4>

<!-- Mensajes flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="card">
    <div class="card-body">
        <form method="POST">
            <div class="row mb-3">
                <div class="col-md-6">
                    <label for="docente_id" class="form-label">Docente *</label>
                    <select name="docente_id" id="docente_id" class="form-select" required>
                        <option value="">Seleccione un docente...</option>
                        {% for docente in docentes %}
                            <option value="{{ docente.id }}">
                                {{ docente.nombre }}
                                {% if docente.documento %}({{ docente.documento }}){% endif %}
                            </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="col-md-6">
                    <label for="tipo" class="form-label">Tipo de Permiso *</label>
                    <select name="tipo" id="tipo" class="form-select" required>
                        <option value="">Seleccione tipo...</option>
                        <option value="Vacaciones">Vacaciones</option>
                        <option value="Enfermedad">Enfermedad</option>
                        <option value="Capacitaci√≥n">Capacitaci√≥n</option>
                        <option value="Permiso Personal">Permiso Personal</option>
                        <option value="Licencia">Licencia</option>
                        <option value="Tiquetera de la felicidad">Tiquetera de la felicidad</option>
                        <option value="Cumplea√±os">Cumplea√±os</option>
                        <option value="Jurado de votaci√≥n">Jurado de votaci√≥n</option>
                    </select>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="fecha_inicio" class="form-label">Fecha de Inicio *</label>
                    <input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control" required>
                </div>

                <div class="col-md-4">
                    <label for="fecha_fin" class="form-label">Fecha de Fin *</label>
                    <input type="date" name="fecha_fin" id="fecha_fin" class="form-control" required>
                </div>

                <div class="col-md-4">
                    <label for="observacion" class="form-label">Observaci√≥n</label>
                    <input type="text" name="observacion" id="observacion" class="form-control"
                           placeholder="Opcional">
                </div>
            </div>

            <div class="d-flex justify-content-end gap-2">
                <a href="{{ url_for('permiso.listado') }}" class="btn btn-secondary">
                    ‚¨ÖÔ∏è Cancelar
                </a>
                <button type="submit" class="btn btn-success">
                    üíæ Registrar Permiso
                </button>
            </div>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Establecer fecha m√≠nima como hoy
        const hoy = new Date().toISOString().split('T')[0];
        const fechaInicio = document.getElementById('fecha_inicio');
        const fechaFin = document.getElementById('fecha_fin');

        fechaInicio.min = hoy;

        // Cuando cambia la fecha de inicio, actualizar m√≠nima de fin
        fechaInicio.addEventListener('change', function() {
            fechaFin.min = this.value;
        });

        // Establecer fecha por defecto
        fechaInicio.value = hoy;
        fechaFin.value = hoy;

        // Validaci√≥n: fecha fin no puede ser anterior a fecha inicio
        document.querySelector('form').addEventListener('submit', function(e) {
            if (new Date(fechaFin.value) < new Date(fechaInicio.value)) {
                e.preventDefault();
                alert('Error: La fecha de fin no puede ser anterior a la fecha de inicio');
                fechaFin.focus();
            }
        });
    });
</script>

{% endblock %}